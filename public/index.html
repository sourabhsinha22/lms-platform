<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LMS Platform</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“š</text></svg>">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.3.1/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.3.1/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.24.7/babel.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: system-ui, sans-serif; }
    #root { min-height: 100vh; }
    .api-loading { display: flex; align-items: center; justify-content: center; height: 100vh; background: #f5f5f0; }
    .api-loading .spinner { width: 40px; height: 40px; border: 4px solid #e0e0e0; border-top: 4px solid #2D6A4F; border-radius: 50%; animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div id="root"><div class="api-loading"><div class="spinner"></div></div></div>
  <script>
    // API client for the backend
    window.API = {
      token: localStorage.getItem('lms_token'),
      
      async request(path, options = {}) {
        const headers = { 'Content-Type': 'application/json' };
        if (this.token) headers['Authorization'] = 'Bearer ' + this.token;
        const res = await fetch('/api' + path, { ...options, headers });
        if (res.status === 401) { this.token = null; localStorage.removeItem('lms_token'); window.location.reload(); }
        return res.json();
      },
      
      async login(email, password, orgSlug) {
        const data = await this.request('/auth/login', { method: 'POST', body: JSON.stringify({ email, password, orgSlug }) });
        if (data.token) { this.token = data.token; localStorage.setItem('lms_token', data.token); }
        return data;
      },
      
      async logout() {
        await this.request('/auth/logout', { method: 'POST' });
        this.token = null;
        localStorage.removeItem('lms_token');
      },
      
      me: () => window.API.request('/auth/me'),
      orgs: () => window.API.request('/organizations'),
      courses: (q) => window.API.request('/courses' + (q ? '?search=' + q : '')),
      course: (id) => window.API.request('/courses/' + id),
      enroll: (id) => window.API.request('/courses/' + id + '/enroll', { method: 'POST' }),
      completeLesson: (id, score) => window.API.request('/lessons/' + id + '/complete', { method: 'POST', body: JSON.stringify({ score }) }),
      experts: () => window.API.request('/experts'),
      bookSession: (expertId, scheduledAt, notes) => window.API.request('/sessions', { method: 'POST', body: JSON.stringify({ expertId, scheduledAt, notes }) }),
      achievements: () => window.API.request('/achievements'),
      users: (q) => window.API.request('/users' + (q ? '?search=' + q : '')),
      invite: (emails, role) => window.API.request('/users/invite', { method: 'POST', body: JSON.stringify({ emails, role }) }),
      updateUser: (id, data) => window.API.request('/users/' + id, { method: 'PUT', body: JSON.stringify(data) }),
      analytics: () => window.API.request('/analytics'),
      updateProfile: (data) => window.API.request('/settings/profile', { method: 'PUT', body: JSON.stringify(data) }),
      updatePassword: (data) => window.API.request('/settings/password', { method: 'PUT', body: JSON.stringify(data) }),
      createCourse: (data) => window.API.request('/courses', { method: 'POST', body: JSON.stringify(data) }),
    };
  </script>
  <script type="text/babel" src="/app.jsx"></script>
  <script type="text/babel">
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(LMSApp));
  </script>
</body>
</html>
